<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Drive ã‚¢ã‚¯ã‚»ã‚¹ã‚µãƒ³ãƒ—ãƒ«</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        .setup-notice {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            color: #856404;
        }
        .setup-notice h3 {
            margin-bottom: 10px;
            color: #856404;
        }
        .setup-notice ol {
            margin-left: 20px;
            line-height: 1.8;
        }
        .setup-notice code {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
        .auth-section {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        button {
            background: #4285f4;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
            margin-right: 10px;
        }
        button:hover {
            background: #357abd;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        #status {
            padding: 15px;
            margin: 20px 0;
            border-radius: 6px;
            display: none;
        }
        #status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        #status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        #fileList {
            margin-top: 20px;
        }
        .file-item {
            padding: 12px;
            margin: 8px 0;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #4285f4;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .file-info {
            flex: 1;
        }
        .file-name {
            font-weight: 600;
            color: #333;
        }
        .file-date {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }
        .create-section {
            margin: 20px 0;
            padding: 20px;
            background: #e8f5e9;
            border-radius: 8px;
        }
        input[type="text"], textarea {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
        }
        textarea {
            resize: vertical;
            min-height: 100px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ Google Drive ã‚¢ã‚¯ã‚»ã‚¹ã‚µãƒ³ãƒ—ãƒ«</h1>
        
        <div class="setup-notice">
            <h3>ğŸ”§ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå¿…è¦ã§ã™</h3>
            <ol>
                <li><a href="https://console.cloud.google.com/" target="_blank">Google Cloud Console</a>ã«ã‚¢ã‚¯ã‚»ã‚¹</li>
                <li>æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ</li>
                <li>ã€ŒAPIã¨ã‚µãƒ¼ãƒ“ã‚¹ã€â†’ã€Œãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€â†’ã€ŒGoogle Drive APIã€ã‚’æœ‰åŠ¹åŒ–</li>
                <li>ã€Œèªè¨¼æƒ…å ±ã€â†’ã€Œèªè¨¼æƒ…å ±ã‚’ä½œæˆã€â†’ã€ŒOAuthã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã€ã‚’é¸æŠ</li>
                <li>ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ—ï¼šã€Œã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€</li>
                <li>æ‰¿èªæ¸ˆã¿ã®JavaScriptç”Ÿæˆå…ƒï¼š<code>http://localhost:8000</code>ï¼ˆã¾ãŸã¯ã‚ãªãŸã®ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼‰</li>
                <li>å–å¾—ã—ãŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã‚’ä¸‹è¨˜ã®ã‚³ãƒ¼ãƒ‰ã«è¨­å®šã—ã¦ãã ã•ã„</li>
            </ol>
        </div>

        <div class="auth-section">
            <h3>èªè¨¼çŠ¶æ…‹</h3>
            <div id="authStatus">æœªèªè¨¼</div>
            <div class="action-buttons">
                <button id="authorizeBtn" onclick="handleAuthClick()">Google Drive ã«æ¥ç¶š</button>
                <button id="signoutBtn" onclick="handleSignoutClick()" style="display:none; background:#dc3545;">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
            </div>
        </div>

        <div id="status"></div>

        <div class="create-section" id="createSection" style="display:none;">
            <h3>æ–°ã—ã„ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ</h3>
            <input type="text" id="fileName" placeholder="ãƒ•ã‚¡ã‚¤ãƒ«åï¼ˆä¾‹: test.txtï¼‰">
            <textarea id="fileContent" placeholder="ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea>
            <button onclick="createFile()">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ</button>
        </div>

        <div id="actionSection" style="display:none;">
            <h3>æ“ä½œ</h3>
            <div class="action-buttons">
                <button onclick="listFiles()">ğŸ“‹ ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’å–å¾—</button>
                <button onclick="toggleCreateSection()">ğŸ“ æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ</button>
            </div>
        </div>

        <div id="fileList"></div>
    </div>

    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script>
        // âš ï¸ ã“ã“ã«ã‚ãªãŸã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã‚’è¨­å®šã—ã¦ãã ã•ã„
        const CLIENT_ID = '1037372041874-9u3hh24prhieiesmuhdh4v55ts8obj30.apps.googleusercontent.com';
        const API_KEY = 'YOUR_API_KEY_HERE';  // ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼šAPIã‚­ãƒ¼ã‚‚è¨­å®šå¯èƒ½
        const SCOPES = 'https://www.googleapis.com/auth/drive.file';

        let tokenClient;
        let accessToken = null;

        // åˆæœŸåŒ–
        function gapiLoaded() {
            gapi.load('client', initializeGapiClient);
        }

        async function initializeGapiClient() {
            await gapi.client.init({
                apiKey: API_KEY,
                discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],
            });
        }

        function gisLoaded() {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: SCOPES,
                callback: (response) => {
                    if (response.error) {
                        showStatus('èªè¨¼ã‚¨ãƒ©ãƒ¼: ' + response.error, 'error');
                        return;
                    }
                    accessToken = response.access_token;
                    updateAuthUI(true);
                    showStatus('èªè¨¼æˆåŠŸï¼Google Driveã«æ¥ç¶šã—ã¾ã—ãŸ', 'success');
                },
            });
        }

        function handleAuthClick() {
            if (CLIENT_ID === 'YOUR_CLIENT_ID_HERE.apps.googleusercontent.com') {
                showStatus('ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã‚’è¨­å®šã—ã¦ãã ã•ã„', 'error');
                return;
            }
            tokenClient.requestAccessToken();
        }

        function handleSignoutClick() {
            if (accessToken) {
                google.accounts.oauth2.revoke(accessToken, () => {
                    accessToken = null;
                    updateAuthUI(false);
                    showStatus('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ', 'success');
                });
            }
        }

        function updateAuthUI(isSignedIn) {
            document.getElementById('authorizeBtn').style.display = isSignedIn ? 'none' : 'inline-block';
            document.getElementById('signoutBtn').style.display = isSignedIn ? 'inline-block' : 'none';
            document.getElementById('authStatus').textContent = isSignedIn ? 'âœ… èªè¨¼æ¸ˆã¿' : 'âŒ æœªèªè¨¼';
            document.getElementById('actionSection').style.display = isSignedIn ? 'block' : 'none';
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§å–å¾—
        async function listFiles() {
            if (!accessToken) {
                showStatus('å…ˆã«èªè¨¼ã—ã¦ãã ã•ã„', 'error');
                return;
            }

            try {
                const response = await fetch('https://www.googleapis.com/drive/v3/files?pageSize=10&fields=files(id,name,mimeType,modifiedTime)', {
                    headers: {
                        'Authorization': `Bearer ${accessToken}`
                    }
                });

                const data = await response.json();
                displayFiles(data.files);
                showStatus(`${data.files.length}ä»¶ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã—ã¾ã—ãŸ`, 'success');
            } catch (error) {
                showStatus('ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
            }
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
        async function createFile() {
            if (!accessToken) {
                showStatus('å…ˆã«èªè¨¼ã—ã¦ãã ã•ã„', 'error');
                return;
            }

            const fileName = document.getElementById('fileName').value;
            const fileContent = document.getElementById('fileContent').value;

            if (!fileName || !fileContent) {
                showStatus('ãƒ•ã‚¡ã‚¤ãƒ«åã¨å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }

            const metadata = {
                name: fileName,
                mimeType: 'text/plain'
            };

            const form = new FormData();
            form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
            form.append('file', new Blob([fileContent], { type: 'text/plain' }));

            try {
                const response = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${accessToken}`
                    },
                    body: form
                });

                const data = await response.json();
                showStatus(`ãƒ•ã‚¡ã‚¤ãƒ«ã€Œ${data.name}ã€ã‚’ä½œæˆã—ã¾ã—ãŸï¼`, 'success');
                document.getElementById('fileName').value = '';
                document.getElementById('fileContent').value = '';
                document.getElementById('createSection').style.display = 'none';
            } catch (error) {
                showStatus('ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
            }
        }

        function toggleCreateSection() {
            const section = document.getElementById('createSection');
            section.style.display = section.style.display === 'none' ? 'block' : 'none';
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«è¡¨ç¤º
        function displayFiles(files) {
            const listDiv = document.getElementById('fileList');
            listDiv.innerHTML = '<h3>ğŸ“„ ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§</h3>';
            
            if (!files || files.length === 0) {
                listDiv.innerHTML += '<p>ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</p>';
                return;
            }

            files.forEach(file => {
                const date = new Date(file.modifiedTime).toLocaleDateString('ja-JP');
                const fileDiv = document.createElement('div');
                fileDiv.className = 'file-item';
                fileDiv.innerHTML = `
                    <div class="file-info">
                        <div class="file-name">${file.name}</div>
                        <div class="file-date">æ›´æ–°æ—¥: ${date}</div>
                    </div>
                `;
                listDiv.appendChild(fileDiv);
            });
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = type;
            statusDiv.style.display = 'block';
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }

        // Google APIãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª­ã¿è¾¼ã¿
        window.onload = () => {
            const script1 = document.createElement('script');
            script1.src = 'https://apis.google.com/js/api.js';
            script1.onload = gapiLoaded;
            document.head.appendChild(script1);

            const script2 = document.createElement('script');
            script2.src = 'https://accounts.google.com/gsi/client';
            script2.onload = gisLoaded;
            document.head.appendChild(script2);
        };
    </script>
</body>
</html>
