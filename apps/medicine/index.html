<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="favicon.ico">
    <title>ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã‚¢ãƒ—ãƒª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f9fafb;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .header {
            margin-bottom: 24px;
        }

        .header h1 {
            font-size: 24px;
            color: #1f2937;
            margin-bottom: 8px;
        }

        .header p {
            color: #6b7280;
        }

        .table-container {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
        }

        .table-header {
            display: grid;
            grid-template-columns: 120px 120px 120px 1fr 80px;
            gap: 16px;
            padding: 16px;
            background-color: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
            font-weight: 600;
            color: #374151;
        }

        .table-row {
            display: grid;
            grid-template-columns: 120px 120px 120px 1fr 80px;
            gap: 16px;
            padding: 16px;
            border-bottom: 1px solid #f3f4f6;
            align-items: center;
        }

        .table-row:last-child {
            border-bottom: none;
        }

        input[type="date"] {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }

        input[type="date"]:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
        }

        input[type="text"] {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
        }

        select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background-color: white;
            font-size: 14px;
        }

        select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
        }

        .actions-container {
            display: flex;
            justify-content: center;
        }

        .delete-btn {
            background: none;
            border: none;
            color: #ef4444;
            padding: 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .delete-btn:hover:not(:disabled) {
            background-color: #fef2f2;
        }

        .delete-btn:disabled {
            color: #d1d5db;
            cursor: not-allowed;
        }

        .add-btn, .export-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background-color: #3b82f6;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .add-btn:hover, .export-btn:hover {
            background-color: #2563eb;
        }

        .export-btn {
            background-color: #10b981;
        }

        .export-btn:hover {
            background-color: #059669;
        }

        .summary {
            margin-top: 24px;
            padding: 16px;
            background-color: #f9fafb;
            border-radius: 8px;
        }

        .summary h3 {
            font-weight: 600;
            color: #374151;
            margin-bottom: 12px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            font-size: 14px;
        }

        .summary-item {
            text-align: center;
        }

        .summary-number {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .summary-label {
            color: #6b7280;
        }

        .blue { color: #3b82f6; }
        .green { color: #10b981; }
        .purple { color: #8b5cf6; }
        .orange { color: #f59e0b; }

        @media (max-width: 768px) {
            .table-header, .table-row {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .summary-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã‚¢ãƒ—ãƒª</h1>
            <p>æ—¥ã€…ã®è¨˜éŒ²ã‚’ç®¡ç†ã—ã¾ã—ã‚‡ã†</p>
        </div>

        <div class="table-container">
            <div class="table-header">
                <div>æ—¥ä»˜</div>
                <div>1å›ç›®</div>
                <div>2å›ç›®</div>
                <div>å‚™è€ƒ</div>
                <div>æ“ä½œ</div>
            </div>
            <div id="entries-container">
                <!-- ã‚¨ãƒ³ãƒˆãƒªãŒã“ã“ã«å‹•çš„ã«è¿½åŠ ã•ã‚Œã¾ã™ -->
            </div>
        </div>

        <div style="display: flex; gap: 12px; justify-content: center; margin-top: 16px; flex-wrap: wrap;">
            <button class="add-btn" onclick="addEntry()">
                â• æ–°ã—ã„ã‚¨ãƒ³ãƒˆãƒªã‚’è¿½åŠ 
            </button>
            <button class="export-btn" onclick="exportToCSV()">
                ğŸ’¾ CSVå‡ºåŠ›
            </button>
            <button class="export-btn" onclick="backupData()" style="background-color: #f59e0b;">
                ğŸ“¦ ãƒ‡ãƒ¼ã‚¿ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
            </button>
            <label class="export-btn" style="background-color: #8b5cf6; cursor: pointer;">
                ğŸ“ ãƒ‡ãƒ¼ã‚¿å¾©å…ƒ
                <input type="file" id="restore-file" accept=".json" style="display: none;" onchange="restoreData(event)">
            </label>
        </div>

        <div class="summary">
            <h3>ã‚µãƒãƒªãƒ¼</h3>
            <div class="summary-grid">
                <div class="summary-item">
                    <div class="summary-number blue" id="total-entries">0</div>
                    <div class="summary-label">ç·ã‚¨ãƒ³ãƒˆãƒªæ•°</div>
                </div>
                <div class="summary-item">
                    <div class="summary-number green" id="first-good">0</div>
                    <div class="summary-label">1å›ç›® â—¯</div>
                </div>
                <div class="summary-item">
                    <div class="summary-number purple" id="second-good">0</div>
                    <div class="summary-label">2å›ç›® â—¯</div>
                </div>
                <div class="summary-item">
                    <div class="summary-number orange" id="total-good">0</div>
                    <div class="summary-label">åˆè¨ˆ â—¯ åŠ¹æœ</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let entries = [];
        const STORAGE_KEY = 'tracking_app_data';

        // åˆæœŸã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚’ç”Ÿæˆï¼ˆ2025-08-27ã‹ã‚‰2025-09-30ã¾ã§ï¼‰
        function generateInitialEntries() {
            const dates = [];
            const start = new Date('2025-08-27');
            const end = new Date('2025-09-30');

            for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
                dates.push(new Date(d).toISOString().split('T')[0]);
            }

            return dates.map((date, index) => ({
                id: index + 1,
                date: date,
                firstTime: '',
                secondTime: '',
                notes: ''
            }));
        }

        // localStorageã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
        function loadData() {
            try {
                const savedData = localStorage.getItem(STORAGE_KEY);
                if (savedData) {
                    const parsedData = JSON.parse(savedData);
                    if (Array.isArray(parsedData) && parsedData.length > 0) {
                        // å¤ã„ãƒ‡ãƒ¼ã‚¿å½¢å¼ã‹ã‚‰æ–°ã—ã„å½¢å¼ã«å¤‰æ›
                        entries = parsedData.map(entry => ({
                            id: entry.id,
                            date: entry.date,
                            firstTime: entry.firstTime === true ? 'â—¯' : (entry.firstTime || ''),
                            secondTime: entry.secondTime === true ? 'â—¯' : (entry.secondTime || ''),
                            notes: entry.notes || ''
                        }));
                        return;
                    }
                }
            } catch (e) {
                console.error('Failed to load data:', e);
            }

            // ä¿å­˜ãƒ‡ãƒ¼ã‚¿ãŒç„¡ã„å ´åˆã¯åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
            entries = generateInitialEntries();
            saveData();
        }

        // localStorageã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
        function saveData() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(entries));
            } catch (e) {
                console.error('Failed to save data:', e);
            }
        }

        // ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚’è¿½åŠ 
        function addEntry() {
            const newEntry = {
                id: Date.now(),
                date: '',
                firstTime: '',
                secondTime: '',
                notes: ''
            };
            entries.push(newEntry);
            saveData();
            renderEntries();
        }

        // ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚’å‰Šé™¤
        function removeEntry(id) {
            if (entries.length > 1) {
                entries = entries.filter(entry => entry.id !== id);
                saveData();
                renderEntries();
            }
        }

        // ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã®å€¤ã‚’æ›´æ–°
        function updateEntry(id, field, value) {
            const entry = entries.find(e => e.id === id);
            if (entry) {
                entry[field] = value;
                saveData();
                updateSummary();
            }
        }

        // å…¨ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚’ç”»é¢ã«æç”»
        function renderEntries() {
            const container = document.getElementById('entries-container');
            if (!container) {
                console.error('Container not found');
                return;
            }

            container.innerHTML = '';

            entries.forEach(entry => {
                const row = document.createElement('div');
                row.className = 'table-row';
                row.innerHTML = `
                    <div>
                        <input
                            type="date"
                            value="${entry.date}"
                            onchange="updateEntry(${entry.id}, 'date', this.value)"
                        >
                    </div>
                    <div>
                        <select onchange="updateEntry(${entry.id}, 'firstTime', this.value)">
                            <option value="">é¸æŠ</option>
                            <option value="â—¯" ${entry.firstTime === 'â—¯' ? 'selected' : ''}>â—¯</option>
                            <option value="â–³" ${entry.firstTime === 'â–³' ? 'selected' : ''}>â–³</option>
                            <option value="âœ—" ${entry.firstTime === 'âœ—' ? 'selected' : ''}>âœ—</option>
                            <option value="å¿˜ã‚ŒãŸ" ${entry.firstTime === 'å¿˜ã‚ŒãŸ' ? 'selected' : ''}>å¿˜ã‚ŒãŸ</option>
                        </select>
                    </div>
                    <div>
                        <select onchange="updateEntry(${entry.id}, 'secondTime', this.value)">
                            <option value="">é¸æŠ</option>
                            <option value="â—¯" ${entry.secondTime === 'â—¯' ? 'selected' : ''}>â—¯</option>
                            <option value="â–³" ${entry.secondTime === 'â–³' ? 'selected' : ''}>â–³</option>
                            <option value="âœ—" ${entry.secondTime === 'âœ—' ? 'selected' : ''}>âœ—</option>
                            <option value="å¿˜ã‚ŒãŸ" ${entry.secondTime === 'å¿˜ã‚ŒãŸ' ? 'selected' : ''}>å¿˜ã‚ŒãŸ</option>
                        </select>
                    </div>
                    <div>
                        <input
                            type="text"
                            value="${entry.notes}"
                            placeholder="å‚™è€ƒã‚’å…¥åŠ›..."
                            onchange="updateEntry(${entry.id}, 'notes', this.value)"
                        >
                    </div>
                    <div class="actions-container">
                        <button
                            class="delete-btn"
                            onclick="removeEntry(${entry.id})"
                            ${entries.length === 1 ? 'disabled' : ''}
                        >
                            ğŸ—‘ï¸
                        </button>
                    </div>
                `;
                container.appendChild(row);
            });

            updateSummary();
        }

        // ã‚µãƒãƒªãƒ¼çµ±è¨ˆã‚’æ›´æ–°
        function updateSummary() {
            document.getElementById('total-entries').textContent = entries.length;
            document.getElementById('first-good').textContent =
                entries.filter(e => e.firstTime === 'â—¯').length;
            document.getElementById('second-good').textContent =
                entries.filter(e => e.secondTime === 'â—¯').length;
            document.getElementById('total-good').textContent =
                entries.filter(e => e.firstTime === 'â—¯' || e.secondTime === 'â—¯').length;
        }

        // CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        function exportToCSV() {
            const headers = ['æ—¥ä»˜', '1å›ç›®', '2å›ç›®', 'å‚™è€ƒ'];
            const csvRows = entries.map(entry => [
                entry.date || '',
                entry.firstTime || '',
                entry.secondTime || '',
                entry.notes || ''
            ]);

            const allRows = [headers, ...csvRows];
            const csvContent = allRows.map(row =>
                row.map(field => `"${field}"`).join(',')
            ).join('\n');

            const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);

            link.setAttribute('href', url);
            link.setAttribute('download', `tracking_data_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';

            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // ãƒ‡ãƒ¼ã‚¿ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
        function backupData() {
            const backupData = {
                exportDate: new Date().toISOString(),
                version: "1.0",
                entries: entries
            };

            const jsonContent = JSON.stringify(backupData, null, 2);
            const blob = new Blob([jsonContent], { type: 'application/json;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);

            link.setAttribute('href', url);
            link.setAttribute('download', `tracking_backup_${new Date().toISOString().split('T')[0]}.json`);
            link.style.visibility = 'hidden';

            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            alert('ãƒ‡ãƒ¼ã‚¿ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸï¼');
        }

        // ãƒ‡ãƒ¼ã‚¿å¾©å…ƒ
        function restoreData(event) {
            const file = event.target.files[0];
            if (!file) {
                return;
            }

            if (file.type !== 'application/json') {
                alert('JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    // ãƒ‡ãƒ¼ã‚¿ã®æ¤œè¨¼
                    if (!backupData.entries || !Array.isArray(backupData.entries)) {
                        alert('ç„¡åŠ¹ãªãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚');
                        return;
                    }

                    // ãƒ‡ãƒ¼ã‚¿ã®å¾©å…ƒå‰ã«ç¢ºèª
                    const confirmMessage = `ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ï¼ˆ${entries.length}ä»¶ï¼‰ã‚’å‰Šé™¤ã—ã¦ã€ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ï¼ˆ${backupData.entries.length}ä»¶ï¼‰ã‚’å¾©å…ƒã—ã¾ã™ã‹ï¼Ÿ\n\nâ€»ã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚`;
                    
                    if (!confirm(confirmMessage)) {
                        return;
                    }

                    // ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒ
                    entries = backupData.entries.map(entry => ({
                        id: entry.id || Date.now() + Math.random(),
                        date: entry.date || '',
                        firstTime: entry.firstTime || '',
                        secondTime: entry.secondTime || '',
                        notes: entry.notes || ''
                    }));

                    // ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¦ç”»é¢ã‚’æ›´æ–°
                    saveData();
                    renderEntries();
                    
                    alert(`ãƒ‡ãƒ¼ã‚¿ã®å¾©å…ƒãŒå®Œäº†ã—ã¾ã—ãŸï¼\nå¾©å…ƒã•ã‚ŒãŸã‚¨ãƒ³ãƒˆãƒªæ•°: ${entries.length}ä»¶`);
                    
                } catch (error) {
                    console.error('Restore error:', error);
                    alert('ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ•ã‚¡ã‚¤ãƒ«ãŒç ´æã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚');
                }
            };

            reader.readAsText(file);
            
            // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã‚’ãƒªã‚»ãƒƒãƒˆ
            event.target.value = '';
        }

        // ã‚¢ãƒ—ãƒªåˆæœŸåŒ–
        function init() {
            loadData();
            renderEntries();
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†æ™‚ã«åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>